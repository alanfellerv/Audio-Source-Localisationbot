#include "fir.h"
static const double hreal[256] = {
0.22398226971055962, -0.5636884912299648, 0.946747621937295, -1.001078090503142, 0.9984090360336108, -0.9930496373379243, 0.9928764322890471, -0.987117547572376, 0.8437058851937862, -0.3723206951669756, 0.03730459151932286, 0.0019481209137172661, -0.00024691521179728837, -0.000546906600914982, -0.0005461529433732661, -0.00048803257493229557, -0.000424377717218624, -0.0003671104011818906, -0.0003181898852919751, -0.0002769842815569146, -0.00024230998567424233, -0.00021301080097713143, -0.0001881023293891235, -0.0001667844514793718, -0.0001484171921999622, -0.00013249043143787227, -0.00011859660035566568, -0.00010640839867934182, -9.566130489089154e-05, -8.614005905700599e-05, -7.766826360783297e-05, -7.010037524337372e-05, -6.331551424093498e-05, -5.721265267705222e-05, -5.1706851099402214e-05, -4.6726295818939195e-05, -4.2209950932819984e-05, -3.81056852384095e-05, -3.4368768375119506e-05, -3.096065590849073e-05, -2.784800198486325e-05, -2.5001852374410827e-05, -2.239698137036783e-05, -2.0011344116220228e-05, -1.7825622077378284e-05, -1.5822844106769263e-05, -1.3988069190577247e-05, -1.2308119788103852e-05, -1.077135688992703e-05, -9.367489642950894e-06, -8.087413765607218e-06, -6.923074056683354e-06, -5.867347169986013e-06, -4.913941520683085e-06, -4.057311751112791e-06, -3.292585638893508e-06, -2.6155016983036433e-06, -2.0223560368015647e-06, -1.509957271638926e-06, -1.075588530493124e-06, -7.169757266431431e-07, -4.322614558256027e-07, -2.1998398244856e-07, -7.906090224336915e-08, -8.7771535664527e-09, -8.777153495329038e-09, -7.906090224336915e-08, -2.1998398266886987e-07, -4.32261455641722e-07, -7.169757266431431e-07, -1.07558853045496e-06, -1.509957271701376e-06, -2.0223560368015647e-06, -2.6155016983834406e-06, -3.29258563878769e-06, -4.057311751112791e-06, -4.913941520655329e-06, -5.867347170037188e-06, -6.923074056683354e-06, -8.087413765616759e-06, -9.367489642954363e-06, -1.077135688992703e-05, -1.2308119788109056e-05, -1.3988069190522603e-05, -1.5822844106769263e-05, -1.782562207734619e-05, -2.0011344116175125e-05, -2.239698137036783e-05, -2.50018523744195e-05, -2.7848001984891874e-05, -3.096065590849073e-05, -3.436876837524961e-05, -3.810568523832797e-05, -4.2209950932819984e-05, -4.672629581899991e-05, -5.170685109931548e-05, -5.721265267705222e-05, -6.331551424109804e-05, -7.01003752432254e-05, -7.766826360783297e-05, -8.614005905708492e-05, -9.566130489074929e-05, -0.00010640839867934182, -0.00011859660035575936, -0.00013249043143780288, -0.0001484171921999622, -0.00016678445147938308, -0.00018810232938910963, -0.00021301080097713143, -0.00024230998567428743, -0.00027698428155688206, -0.0003181898852919751, -0.0003671104011819903, -0.00042437771721861185, -0.00048803257493229557, -0.000546152943373482, -0.0005469066009148103, -0.00024691521179728837, 0.001948120913717139, 0.037304591519322944, -0.3723206951669756, 0.8437058851937862, -0.9871175475723761, 0.9928764322890471, -0.9930496373379244, 0.9984090360336106, -1.001078090503142, 0.9467476219372951, -0.5636884912299647, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
};

static const double himag[256] = {
0.0, -0.01373046358769052, 0.046149606815467224, -0.0732694723848614, 0.0975675596886009, -0.12152203791077218, 0.14612112702500635, -0.1699272015491059, 0.16648893153528263, -0.08293797232804206, 0.00926892010586422, 0.0005347307842566984, -7.428572010623083e-05, -0.0001791744138833957, -0.00019377719656850107, -0.00018665664260501206, -0.00017427137388654362, -0.00016131017249906756, -0.00014916129131867283, -0.0001381694617985914, -0.00012833431271820107, -0.00011954745545513304, -0.00011167666375691272, -0.00010459539085776442, -9.819188620762776e-05, -9.237065302107605e-05, -8.705118097448029e-05, -8.216589357352153e-05, -7.765805624570989e-05, -7.347990634813304e-05, -6.959107031850008e-05, -6.595725756394452e-05, -6.254919537875404e-05, -5.9341764452214285e-05, -5.631329763825313e-05, -5.344501017554124e-05, -5.0720535275499464e-05, -4.812554409145222e-05, -4.5647433358865725e-05, -4.327506744938045e-05, -4.09985643299712e-05, -3.880911709436838e-05, -3.669884443031077e-05, -3.466066473698025e-05, -3.26881896451981e-05, -3.0775633536463554e-05, -2.8917736298535537e-05, -2.710969708385417e-05, -2.534711724541715e-05, -2.3625950953888868e-05, -2.1942462268381507e-05, -2.0293187641409575e-05, -1.867490301575407e-05, -1.708459480170561e-05, -1.55194341529526e-05, -1.3976754028156824e-05, -1.2454028626839248e-05, -1.09488548287167e-05, -9.458935331146143e-06, -7.982063212376759e-06, -6.516107685978004e-06, -5.059000839425365e-06, -3.608725170997954e-06, -2.163301757504739e-06, -7.207788995827914e-07, 7.207788995770994e-07, 2.163301757504739e-06, 3.6087251710071293e-06, 5.059000839458067e-06, 6.516107685978004e-06, 7.9820632123525e-06, 9.458935331127548e-06, 1.09488548287167e-05, 1.245402862690159e-05, 1.3976754028187399e-05, 1.55194341529526e-05, 1.708459480164739e-05, 1.8674903015673946e-05, 2.0293187641409575e-05, 2.1942462268465207e-05, 2.362595095394969e-05, 2.534711724541715e-05, 2.7109697083777732e-05, 2.891773629846528e-05, 3.0775633536463554e-05, 3.2688189645313135e-05, 3.466066473702383e-05, 3.669884443031077e-05, 3.8809117094322195e-05, 4.099856432993672e-05, 4.327506744938045e-05, 4.5647433358892396e-05, 4.812554409149234e-05, 5.0720535275499464e-05, 5.34450101754957e-05, 5.631329763825638e-05, 5.9341764452214285e-05, 6.254919537877421e-05, 6.595725756396056e-05, 6.959107031850008e-05, 7.347990634818768e-05, 7.765805624566848e-05, 8.216589357352153e-05, 8.705118097445449e-05, 9.237065302103897e-05, 9.819188620762776e-05, 0.00010459539085775228, 0.000111676663756973, 0.00011954745545513304, 0.00012833431271820042, 0.0001381694617985669, 0.00014916129131867283, 0.00016131017249914887, 0.00017427137388646968, 0.00018665664260501206, 0.0001937771965684384, 0.00017917441388342302, 7.428572010623083e-05, -0.0005347307842566845, -0.009268920105864182, 0.08293797232804206, -0.16648893153528255, 0.16992720154910576, -0.14612112702500635, 0.12152203791077204, -0.09756755968860079, 0.0732694723848614, -0.04614960681546714, 0.013730463587690443, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0
};
#include "config.h"
#include "fft.h"


void complex_array_multiply( double *v1Real,  double *v1Img,const double *v2Real, const double *v2Img,double *r1Real, double *r1Img)
{
    for (uint16_t i = 0; i < sample_no; i++) {
        r1Real[i] = v1Real[i] * v2Real[i] - v1Img[i] * v2Img[i];
        r1Img[i]  = v1Real[i] * v2Img[i] + v1Img[i] * v2Real[i];
    }
}


void FIR_filter(uint8_t l_r,int32_t *sample_buffer, double *res_real, double *res_img)
{
    static double xreal[256];
    static double xImag[256];

    memset(xreal, 0, sizeof(xreal));
    memset(xImag, 0, sizeof(xImag));
    for (uint16_t i = 0; i < sample_no; i++) {
        xreal[i] = (double)(sample_buffer[i * 2 + l_r]>>8);
    }
    FFT(xreal,xImag,256);
    complex_array_multiply( xreal, xImag, hreal , himag, res_real,res_img);
}